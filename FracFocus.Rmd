---
title: "Final Project"
author: "Shaun Donmoyer"
date: "10/23/2019"
output: html_document
---

# Load appropriate library

```{r}
library(odbc)
```

#Connect to database
```{r}
con <- dbConnect(odbc(),Driver="SQL Server",Server="localhost\\SQLEXPRESS", Database="FracFocusRegistry", Trusted_Connection="True") 
```

#Retreives all disclosures from Regisitry Upload Purpose
```{r}
RUP <- data.table(dbGetQuery(con, "SELECT * FROM [FracFocusRegistry].[dbo].[RegistryUploadPurpose]"))
```


# All Disclosures that include Acetic Acid
```{r}
Acetic <- data.table(dbGetQuery(con, "SELECT * FROM RegistryUploadIngredients Where IngredientName = 'Acetic Acid';"))
```

# All Disclosures that include Ammonium Persulfate
```{r}
AMPSF <- data.table(dbGetQuery(con, "SELECT * FROM RegistryUploadIngredients Where IngredientName = 'Ammonium Persulfate';"))
```

# All Breakers
```{r}
Breaker <- data.table(dbGetQuery(con, "SELECT * FROM RegistryUploadPurpose WHERE Purpose = 'Breaker';"))
```

# Breaker Trade Name and Frequency
```{r}
library(plyr)
Br_Freq <- count(Breaker, TradeName)
```

```{r}
top10_Br <- Br_Freq[c(610,578,315,469,374,313,561,452,222,318),]
```

```{r}
Br_plot <- qplot(TradeName, freq, data=top10_Br, main="Top 10 most used Breakers in FracFocus", xlab="TradeName", ylab="Frequency")
```

```{r}
Br_Plot <- ggplot(top10_Br, aes(x=TradeName, y=freq)) + geom_bar(stat="identity", color="blue",fill="white") + 
     labs(x="TradeName", y="Frequency",title="10 Most Used Breakers in FracFocus")+geom_text(aes(label=freq), vjust=1.6, color="black", size=3.5)+theme(axis.text.x=element_text(size=10,angle=45,hjust=1,vjust=1))

Br_Plot
```


```{r}
br_report <- function(TradeName){
  new_data <- Breaker[Breaker$TradeName %in% "TradeName", ]
    return(new_data)
}
```  
  
```{r}
for(Breaker in Breaker){
  print()
}
```


# Biocide
```{r}
Bio <- data.table(dbGetQuery(con, "SELECT * FROM RegistryUploadPurpose WHERE Purpose = 'Biocide';"))
```

```{r}
Bio_Freq <- count(Bio, "TradeName")
```

# Function for any Ingredient Purpose

```{r}
library(sqldf)
library(dplyr)
```

```{r}
Purpose_report <- function(Purpose){
  Purpose <- sqldf('select Purpose, TradeName from RUP where Purpose = "Breaker"')
  Freq_Purpose <- count(Purpose, TradeName)
  return(Freq_Purpose)
}

  
```


```{r}
report <- function(Purpose){
  Purpose <- sqldf('select Purpose, TradeName from RUP where Purpose = "Breaker"')
  new_data <- Purpose %>% 
    count(TradeName, sort=TRUE)
   new_data <- new_data[c(1:10), ]


  
   Br_Plot <- ggplot(new_data, aes(x=TradeName, y=n)) + geom_bar(stat="identity", color="blue",fill="white") + 
     labs(x="TradeName", y="Frequency",title="10 Most Used Breakers in FracFocus")+geom_text(aes(label=n), vjust=1.6, color="black", size=3.5)+theme(axis.text.x=element_text(size=10,angle=45,hjust=1,vjust=1))

Br_Plot
}
```